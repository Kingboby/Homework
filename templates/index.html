<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Homework Recorder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 480px;
            margin: 50px auto;
            padding: 10px;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
        }
        input, textarea, select, button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            margin-top: 15px;
        }
        input[type="date"] {
            width: 50%;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <h2>Homework Recorder</h2>
    <form method="POST" action="/">
        <!-- Subject Dropdown / Input -->
        <label for="subjectInput">Subject:</label>
        <input list="subjects" id="subjectInput" name="subject" placeholder="Select or type a subject" value="{{ selected }}">
        <datalist id="subjects">
            <option value="-- New Subject --">
            {% for sub in subjects %}
            <option value="{{ sub }}">
            {% endfor %}
        </datalist>

        <!-- Due Date -->
        <label for="dueDateInput">Due Date:</label>
        <input type="date" id="dueDateInput" name="due_date" value="{{ due_date }}">

        <!-- Details -->
        <label for="detailsInput">Details:</label>
        <textarea id="detailsInput" name="details" rows="5">{{ details }}</textarea>

        <!-- Buttons -->
        <button type="submit" name="add">Add / Update</button>
        <button type="submit" name="delete">Delete</button>
    </form>

    <script>
        const subjectInput = document.getElementById('subjectInput');
        const dueDateInput = document.getElementById('dueDateInput');
        const detailsInput = document.getElementById('detailsInput');

        // --- Helpers: ISO <-> DD/MM/YYYY ---
        function isoToDdMmYyyy(iso) {
            if (!iso) return "";
            const parts = iso.split('-');
            if (parts.length !== 3) return "";
            return `${parts[2]}/${parts[1]}/${parts[0]}`;
        }
        function ddmmyyyyToIso(ddmmyyyy) {
            if (!ddmmyyyy) return "";
            const parts = ddmmyyyy.split('/');
            if (parts.length !== 3) return "";
            return `${parts[2]}-${parts[1]}-${parts[0]}`;
        }

        // --- Subject selection ---
        subjectInput.addEventListener('change', () => {
            const val = subjectInput.value.trim();
            if (val === "" || val === "-- New Subject --") {
                subjectInput.value = "";
                dueDateInput.value = "";
                detailsInput.value = "";
                subjectInput.focus();
                return;
            }
            window.location.href = `/?subject=${encodeURIComponent(val)}`;
        });

        // --- Format date after selecting ---
        dueDateInput.addEventListener('change', () => {
            const iso = dueDateInput.value; // YYYY-MM-DD
            dueDateInput.value = isoToDdMmYyyy(iso);
        });

        // --- Convert pre-filled value from backend on page load ---
        window.addEventListener('load', () => {
            if (dueDateInput.value.includes('-')) { // likely YYYY-MM-DD from Flask
                dueDateInput.value = isoToDdMmYyyy(dueDateInput.value);
            }
        });
    </script>
</body>
</html>
