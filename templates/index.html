<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Homework Recorder">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden;
            background-color: #f5f5f5;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
            touch-action: manipulation;
        }
    
        .container {
            width: 90%;
            max-width: 420px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            padding: 20px;
            text-align: center;
        }
    
        h1 {
            margin-bottom: 20px;
        }
    
        input, textarea, button {
            width: 100%;
            margin: 8px 0;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
        }
    
        input[list] {
            font-size: 18px;
            padding: 16px;
        }
    
        .date-row {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
        }
    
        .calendar-button {
            width: 48px;
            height: 48px;
            font-size: 22px;
            border-radius: 8px;
            background-color: #007BFF;
            color: white;
            border: none;
        }
    
        .calendar-button:hover {
            background-color: #0056b3;
        }
    
        button {
            background-color: #007BFF;
            color: white;
            border: none;
            font-weight: bold;
        }
    
        button:hover {
            background-color: #0056b3;
        }
    
        .delete {
            background-color: #dc3545;
        }
    
        .delete:hover {
            background-color: #b02a37;
        }
    </style>

</head>
<body>
    <h2>Homework Recorder</h2>
    <form method="POST" action="/">
        <!-- Subject Dropdown / Input -->
        <label for="subjectInput">Subject:</label>
        <input list="subjects" id="subjectInput" name="subject" placeholder="Select or type a subject" value="{{ selected }}">
        <datalist id="subjects">
            <option value="-- New Subject --">
            {% for sub in subjects %}
            <option value="{{ sub }}">
            {% endfor %}
        </datalist>

        <!-- Due Date -->
               <!-- Due Date -->
        <label for="dueDateInput">Due Date:</label>
        <div class="date-row">
            <input type="date" id="dueDateInput" name="due_date" value="{{ due_date }}">
        </div>


        <!-- Details -->
        <label for="detailsInput">Details:</label>
        <textarea id="detailsInput" name="details" rows="5">{{ details }}</textarea>

        <!-- Buttons -->
        <button type="submit" name="add">Add / Update</button>
        <button type="submit" name="delete">Delete</button>
    </form>

    <script>
        const subjectInput = document.getElementById('subjectInput');
        const dueDateInput = document.getElementById('dueDateInput');
        const detailsInput = document.getElementById('detailsInput');

        // --- Helpers: ISO <-> DD/MM/YYYY ---
               // --- Helpers: ISO <-> DD/MM/YYYY ---
        function isoToDdMmYyyy(iso) {
            if (!iso) return "";
            const parts = iso.split('-');
            if (parts.length !== 3) return "";
            return `${parts[2]}/${parts[1]}/${parts[0]}`;
        }
        function ddmmyyyyToIso(ddmmyyyy) {
            if (!ddmmyyyy) return "";
            const parts = ddmmyyyy.split('/');
            if (parts.length !== 3) return "";
            return `${parts[2]}-${parts[1]}-${parts[0]}`;
        }
        
        // --- Format date after selecting ---
        dueDateInput.addEventListener('change', () => {
            const iso = dueDateInput.value; // YYYY-MM-DD
            dueDateInput.value = isoToDdMmYyyy(iso);
        });
        
        // --- Convert pre-filled value from backend on page load ---
        window.addEventListener('load', () => {
            if (dueDateInput.value.includes('-')) { // likely YYYY-MM-DD from Flask
                dueDateInput.value = isoToDdMmYyyy(dueDateInput.value);
            }
        });


        // --- Subject selection ---
        subjectInput.addEventListener('change', () => {
            const val = subjectInput.value.trim();
            if (val === "" || val === "-- New Subject --") {
                subjectInput.value = "";
                dueDateInput.value = "";
                detailsInput.value = "";
                subjectInput.focus();
                return;
            }
            window.location.href = `/?subject=${encodeURIComponent(val)}`;
        });

     
    </script>
</body>
</html>


